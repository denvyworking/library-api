# API –ö–∞—Ç–∞–ª–æ–≥–∞ –ö–Ω–∏–≥
> **Production-ready backend –Ω–∞ Go –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º –∫–Ω–∏–≥**  
> –ü–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Å PostgreSQL –∏ Docker-first –ø–æ–¥—Ö–æ–¥–æ–º.  
> –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–∫—Ç–∏–∫ middle-—É—Ä–æ–≤–Ω—è –≤ backend-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

[![Go](https://img.shields.io/badge/Go-1.24+-00ADD8?logo=go)](https://golang.org)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17-336791?logo=postgresql)](https://www.postgresql.org)
[![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?logo=docker)](https://www.docker.com)

## –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

- **–†–∞–∑—Ä–∞–±–æ—Ç–∞–ª** –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (`api` ‚Üí `service` ‚Üí `repository`) –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture
- **–í–Ω–µ–¥—Ä–∏–ª** production-ready –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π zero-downtime –¥–µ–ø–ª–æ—è
- **–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª** –≥–∏–±–∫—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: –ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤/–∂–∞–Ω—Ä–æ–≤, –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ ‚Äî –¥–ª—è –∫–Ω–∏–≥
- **–û–±–µ—Å–ø–µ—á–∏–ª** –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: unit-—Ç–µ—Å—Ç—ã —Å —Ñ–µ–π–∫–æ–≤—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î + E2E-—Ç–µ—Å—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ –ª–æ–≥–∏–∫–µ http –∑–∞–ø—Ä–æ—Å–æ–≤ books/author/genre
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª** —Ä–∞–±–æ—Ç—É —Å –ë–î —á–µ—Ä–µ–∑ connection pooling (`pgx`), —Ç–∞–π–º–∞—É—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –∏–Ω–¥–µ–∫—Å –Ω–∞ —á–∞—Å—Ç—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã.
- **–£—Å—Ç—Ä–∞–Ω–∏–ª** —Ä–∏—Å–∫–∏ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–∞: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω graceful shutdown (–æ–±—Ä–∞–±–æ—Ç–∫–∞ SIGTERM/SIGINT)
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–ª** —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö: –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏, check-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ PostgreSQL

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –£—Ä–æ–≤–µ–Ω—å        | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                     |
|----------------|--------------------------------|
| –Ø–∑—ã–∫           | Go 1.24+                       |
| –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫  | `net/http` + Gorilla Mux       |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö    | PostgreSQL 17                  |
| –ú–∏–≥—Ä–∞—Ü–∏–∏       | `golang-migrate`               |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ   | `testify`, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î     |
| –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | Docker, Docker Compose         |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ    | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ (`slog`)     |


##  –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
``` bash
.
‚îú‚îÄ‚îÄ cmd/
‚îÇ ‚îú‚îÄ‚îÄ main/ # –û—Å–Ω–æ–≤–Ω–æ–π HTTP-—Å–µ—Ä–≤–µ—Ä
‚îÇ ‚îî‚îÄ‚îÄ migrate/ # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ migrations/ # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pkg/
‚îÇ ‚îú‚îÄ‚îÄ api/ # HTTP-—Ö–µ–Ω–¥–ª–µ—Ä—ã, middleware, E2E-—Ç–µ—Å—Ç—ã
‚îÇ ‚îú‚îÄ‚îÄ service/ # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, unit-—Ç–µ—Å—Ç—ã
‚îÇ ‚îú‚îÄ‚îÄ repository/ # –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ ‚îî‚îÄ‚îÄ models/ # DTO –∏ –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ .env # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)
‚îú‚îÄ‚îÄ .env.example # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ Dockerfile
```

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.24+
- Docker + Docker Compose

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –≤ Docker
docker-compose up -d postgres

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
go run ./cmd/migrate up

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
go run ./cmd/main

```
```bash
# –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
go run ./cmd/migrate down
```
### –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è: –º–∏–≥—Ä–∞—Ü–∏–∏ ‚â† —Å–µ—Ä–≤–∏c
–°–µ—Ä–≤–∏—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç —Å—Ö–µ–º—É –ë–î ‚Äî –æ–Ω —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ.

### –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose up --build
```

### –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω–∞):

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                        | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|-------|-----------------------------|------------------------------|
| GET   | `/api/books`                | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥             |
| GET   | `/api/books/withauthors`    | –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ —Å –∞–≤—Ç–æ—Ä–∞–º–∏       |
| GET   | `/api/authors`              | –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤               |
| POST  | `/api/authors`              | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞     |
| GET   | `/api/genres`               | –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤                |
| POST  | `/api/genres`               | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∂–∞–Ω—Ä–∞      |

###  –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω–∞)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                        | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|-------|-----------------------------|------------------------------|
| POST  | `/api/books`                | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–Ω–∏–≥–∏         |
| PATCH | `/api/books?id={id}`        | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏   |
| DELETE| `/api/books?id={id}`        | –£–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏               |



>  –í—Å–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:  
> `Authorization: <–≤–∞—à_—Ç–æ–∫–µ–Ω>` (—Å–º. —Ä–∞–∑–¥–µ–ª [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-authorization))


## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Authorization)

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization: <—Ç–æ–∫–µ–Ω> (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è AUTH_TOKEN) *adminToken –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é*.
### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
``` bash
curl -X PATCH "http://localhost:8080/api/books?id=5" \
  -H "Authorization: adminToken" \
  -H "Content-Type: application/json" \
  -d '{"price": 599}'
```
``` bash
curl -X DELETE "http://localhost:8080/api/books?id=5" \
  -H "Authorization: adminToken"
```


## –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
* Unit-—Ç–µ—Å—Ç—ã: –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–µ–π–∫–æ–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
* Integration-—Ç–µ—Å—Ç—ã 
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π PostgreSQL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏ –æ—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ë–î (—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å, check-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ TRUNCATE ... RESTART IDENTITY
* E2E-—Ç–µ—Å—Ç—ã: —Å–∫–≤–æ–∑–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ HTTP-—Å–ª–æ—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏ middleware
–ü–æ–∫—Ä—ã—Ç–∏–µ: –±–æ–ª–µ–µ 75% –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º –≤–æ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–∞—Ö

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
``` bash 
# –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã (–±–µ–∑ –ë–î)
go test ./...

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
go test -v -tags=integration ./pkg/repository/postgres/...

# –¢–æ–ª—å–∫–æ E2E-—Ç–µ—Å—Ç—ã
go test -v -tags=e2e ./pkg/api/...

# –í—Å–µ —Ç–µ—Å—Ç—ã
go test -v -tags="integration e2e" ./...
```
–ò–õ–ò
``` bash 
# –í—Å–µ —Ç–µ—Å—Ç—ã
./goTests.sh
```

